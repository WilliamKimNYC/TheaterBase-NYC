{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
    <div id="success-message" class="alert alert-success" style="display: none;">
        New theater successfully created. 
        <a href="#" id="view-link" class="alert-link">See it here</a>
    </div>

    <h2>Add New Theater</h2>
    <form id="add-theater-form" class="needs-validation" novalidate>
        <div class="mb-3">
            <label for="name" class="form-label">Theater Name*</label>
            <input type="text" class="form-control" id="name" name="name" required>
            <div class="invalid-feedback">Please enter a theater name.</div>
        </div>

        <div class="mb-3">
            <label for="address" class="form-label">Address*</label>
            <input type="text" class="form-control" id="address" name="address" required>
            <div class="invalid-feedback">Please enter an address.</div>
        </div>

        <div class="mb-3">
            <label for="description" class="form-label">Description*</label>
            <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
            <div class="invalid-feedback">Please enter a description.</div>
        </div>

        <div class="mb-3">
            <label for="image" class="form-label">Image URL</label>
            <input type="url" class="form-control" id="image" name="image">
            <div class="invalid-feedback">Please enter a valid URL.</div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="ticket_price" class="form-label">Regular Ticket Price*</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" class="form-control" id="ticket_price" name="ticket_price" min="0" required>
                    <div class="invalid-feedback">Please enter a valid ticket price.</div>
                </div>
            </div>

            <div class="col-md-6 mb-3">
                <label for="student_price" class="form-label">Student Ticket Price*</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" class="form-control" id="student_price" name="student_price" min="0" required>
                    <div class="invalid-feedback">Please enter a valid student ticket price.</div>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label for="movie_types" class="form-label">Types of Movies (comma-separated)*</label>
            <input type="text" class="form-control" id="movie_types" name="movie_types" required>
            <div class="invalid-feedback">Please enter at least one movie type.</div>
            <small class="form-text text-muted">Example: Art House, Classic Films, Foreign</small>
        </div>

        <div class="mb-3">
            <label for="nearby_ids" class="form-label">Nearby Theater IDs (comma-separated)</label>
            <input type="text" class="form-control" id="nearby_ids" name="nearby_ids">
            <small class="form-text text-muted">Example: Film-Forum, IFC-Center</small>
        </div>

        <div class="mb-3">
            <label for="website" class="form-label">Website URL</label>
            <input type="url" class="form-control" id="website" name="website">
            <div class="invalid-feedback">Please enter a valid URL.</div>
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('add-theater-form');
    const successMessage = document.getElementById('success-message');

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Reset custom validity
        form.querySelectorAll('input, textarea').forEach(input => {
            input.setCustomValidity('');
        });

        if (!form.checkValidity()) {
            e.stopPropagation();
            form.classList.add('was-validated');
            return;
        }

        // Prepare the data
        const formData = {
            name: document.getElementById('name').value.trim(),
            address: document.getElementById('address').value.trim(),
            description: document.getElementById('description').value.trim(),
            image: document.getElementById('image').value.trim(),
            ticket_price: document.getElementById('ticket_price').value.trim(),
            student_price: document.getElementById('student_price').value.trim(),
            movie_types: document.getElementById('movie_types').value.trim(),
            nearby_ids: document.getElementById('nearby_ids').value.trim(),
            website: document.getElementById('website').value.trim()
        };

        // Send the data
        fetch('/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Show success message
                successMessage.style.display = 'block';
                document.getElementById('view-link').href = `/view/${data.id}`;
                
                // Clear form
                form.reset();
                form.classList.remove('was-validated');
                document.getElementById('name').focus();
                
                // Scroll to top to see success message
                window.scrollTo(0, 0);
            } else {
                // Handle validation errors
                Object.entries(data.errors).forEach(([field, message]) => {
                    const input = document.getElementById(field);
                    if (input) {
                        input.setCustomValidity(message);
                        input.reportValidity();
                    }
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while saving the theater. Please try again.');
        });
    });
});
</script>
{% endblock %} 